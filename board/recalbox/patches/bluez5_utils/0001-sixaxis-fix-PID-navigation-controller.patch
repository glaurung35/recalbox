From f32eb9b4d462fc0387346598000ad940840f3972 Mon Sep 17 00:00:00 2001
From: David Barbion <davidb@230ruedubac.fr>
Date: Wed, 24 Jan 2024 23:34:53 +0100
Subject: [PATCH 1/6] sixaxis-fix-PID-navigation-controller

---
 plugins/sixaxis.c        | 7 ++++++-
 profiles/input/sixaxis.h | 2 ++
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/plugins/sixaxis.c b/plugins/sixaxis.c
index 544ab399a..d5c3e552b 100644
--- a/plugins/sixaxis.c
+++ b/plugins/sixaxis.c
@@ -349,7 +349,12 @@ static bool setup_device(int fd, const char *sysfs_path,
 	info("sixaxis: setting up new device");
 
 	btd_device_device_set_name(device, cp->name);
-	btd_device_set_pnpid(device, cp->source, cp->vid, cp->pid, cp->version);
+	/* if device reports different pid/vid on BT prefer those over USB */
+	if (cp->bt_pid)
+		btd_device_set_pnpid(device, cp->source, cp->vid, cp->bt_pid, cp->version);
+	else
+		btd_device_set_pnpid(device, cp->source, cp->vid, cp->pid, cp->version);
+	btd_device_set_trusted(device, false);
 	btd_device_set_temporary(device, true);
 
 	closure = g_new0(struct authentication_closure, 1);
diff --git a/profiles/input/sixaxis.h b/profiles/input/sixaxis.h
index ab8831995..80006b75a 100644
--- a/profiles/input/sixaxis.h
+++ b/profiles/input/sixaxis.h
@@ -25,6 +25,7 @@ struct cable_pairing {
 	uint16_t vid;
 	uint16_t pid;
 	uint16_t version;
+  uint16_t bt_pid;
 	CablePairingType type;
 };
 
@@ -54,6 +55,7 @@ get_pairing(uint16_t vid, uint16_t pid, const char *name)
 			.vid = 0x054c,
 			.pid = 0x042f,
 			.version = 0x0000,
+      .bt_pid = 0x0268,
 			.type = CABLE_PAIRING_SIXAXIS,
 		},
 		{
-- 
2.43.0

