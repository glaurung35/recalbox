--- a/xbmc/messaging/ApplicationMessenger.cpp	2025-01-25 21:53:38.586874970 +0100
+++ b/xbmc/messaging/ApplicationMessenger.cpp	2024-01-25 21:55:21.658634888 +0100
@@ -34,6 +34,27 @@
     ThreadMessage  m_msg;
 };
 
+void RecalboxMsg(unsigned int dwMessage) {
+  //CLog::Log(LOGNOTICE, "RECALBOX MESSAGE %i (SHUTDOWN=%i, POWERDOWN=%i, QUIT=%i, RESTART=%i)", pMsg->dwMessage, TMSG_SHUTDOWN, TMSG_POWERDOWN, TMSG_QUIT, TMSG_RESTART);
+  if(dwMessage == TMSG_QUIT || dwMessage == TMSG_RESTART || dwMessage == TMSG_POWERDOWN) {
+    FILE* fd = fopen("/var/run/kodi.msg", "a");
+    if(fd != NULL) {
+      switch(dwMessage) {
+      case TMSG_QUIT:
+       fprintf(fd, "EXIT\n");
+       break;
+      case TMSG_RESTART:
+       fprintf(fd, "RESTART\n");
+       break;
+      case TMSG_POWERDOWN:
+       fprintf(fd, "SHUTDOWN\n");
+       break;
+      }
+      fclose(fd);
+    }
+  }
+}
+
 CDelayedMessage::CDelayedMessage(const ThreadMessage& msg, unsigned int delay)
   : CThread("DelayedMessage"), m_msg(msg)
 {
@@ -226,6 +247,8 @@
 
 void CApplicationMessenger::ProcessMessage(ThreadMessage *pMsg)
 {
+  RecalboxMsg(pMsg->dwMessage);
+
   //special case for this that we handle ourselves
   if (pMsg->dwMessage == TMSG_CALLBACK)
   {
